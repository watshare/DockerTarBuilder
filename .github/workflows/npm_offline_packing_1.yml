name: Npm Package Download and Package

on:
  workflow_dispatch:
    inputs:
      npm_packages:
        description: '请填写 npm 包名称，多个用英文逗号分开'
        required: true
        default: 'lodash,axios'  # 设置默认的 npm 包列表

jobs:
  download_and_package:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '23'

    - name: Create a directory for packages
      run: mkdir -p npm_packages

    - name: Download and package npm packages
      run: |
        packages="${{ github.event.inputs.npm_packages }}"
        IFS=',' read -r -a package_array <<< "$packages"
        for package in "${package_array[@]}"; do
          mkdir -p "npm_packages/$package"
          npm pack "$package" --pack-destination "npm_packages/$package"
          cd "npm_packages/$package"
          tar -czvf "$package.tar.gz" *.tgz
          rm *.tgz
          cd ../..
        done

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: npm-packages-artifact
        path: npm_packages/*.tar.gz
        retention-days: 1  # 将保留天数设置为 1 天 最多可设置90天